<%
var makePlugin = function(plugin) {
var installed = !!window.abilities.plugins[plugin.name];
var compatible = semver.satisfies(window.abilities.tilemill.version, plugin.engines.tilemill);
%>
<li><div class='plugin <%= installed ? 'raised' : 'sunken' %>'>
  <%= plugin.name %>
  <small class='description'>
    <%= plugin.description || 'No description.' %><br/>
    <% if (plugin.core) %>TileMill <%=window.abilities.tilemill.version%><%;%>
    <% if (!plugin.core) %>Version <%= plugin.version || 'unknown' %><%;%>
    <% if (!compatible) %>
    <span class='error'>Incompatible with TileMill <%=window.abilities.tilemill.version%></span>
    <%;%>
  </small>
  <div class='actions'>
    <% if (plugin.core) { %>
    <span class='badge'>Core</span>
    <% } else { %>
      <% if (installed) %><a class='button' href='#uninstall'>Uninstall</a><% ; %>
      <% if (!installed && compatible) %><a class='button' href='#install'>Install</a><% ; %>
    <% } %>
  </div>
</div></li>
<% }; %>
<ul class='form sunken'>
  <li class='text'>
    <h2>Installed</h2>
  </li>
  <li class='plugins'><ul class='grid clearfix'>
  <!--
  @TODO
  - Check for updated version of each plugin.
  -->
  <% _(window.abilities.plugins).each(makePlugin); %>
  </ul></li>
</ul>

<ul class='form sunken'>
  <li class='text'>
    <h2>Available</h2>
  </li>
  <li class='plugins'><ul class='grid clearfix'>
  <!--
  @TODO
  - populate this list by searching npm repo.
  - No need for search, pager, etc. initially. as there will be very few.
  -->
  <% _([
    {name:'tilemill-geocoder', version:"0.0.1", engines:{"tilemill":"0.8.x"}},
    {name:'tilemill-google', version:"0.0.1", engines:{"tilemill":"0.8.x"}},
    {name:'tilemill-imagemagick', version:"0.0.1", engines:{"tilemill":"0.8.x"}}
  ]).each(makePlugin); %>
  </ul></li>
</ul>
